<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Neverending Story</title>
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.json">
  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial; background:#070b14; color:#e8eefc; }
    header { padding:14px 16px; display:flex; gap:10px; align-items:center; border-bottom:1px solid #142033; }
    header h1 { font-size:16px; margin:0; font-weight:700; letter-spacing:.2px; }
    header .pill { margin-left:8px; padding:4px 10px; border-radius:999px; background:#121b2c; border:1px solid #1f2b44; font-size:12px; color:#b9c7e7; }
    main { max-width:980px; margin:0 auto; padding:16px; }
    .card { background:#0b1220; border:1px solid #142033; border-radius:14px; padding:14px; margin-bottom:14px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    label { font-size:12px; color:#b9c7e7; display:block; margin-bottom:6px; }
    input, select, textarea { width:100%; box-sizing:border-box; padding:10px; border-radius:12px; border:1px solid #22314e; background:#0a1020; color:#e8eefc; }
    textarea { min-height:96px; resize:vertical; }
    button { padding:10px 12px; border-radius:12px; border:1px solid #22314e; background:#101a2e; color:#e8eefc; cursor:pointer; }
    button.primary { background:#2b6cff; border-color:#2b6cff; }
    button:disabled { opacity:.55; cursor:not-allowed; }
    .muted { color:#9fb0d7; font-size:12px; }
    .story { white-space:pre-wrap; line-height:1.45; font-size:15px; }
    .choices { display:flex; flex-direction:column; gap:8px; }
    .choiceBtn { text-align:left; }
    details summary { cursor:pointer; color:#b9c7e7; }
    .small { font-size:12px; }
    .divider { height:1px; background:#142033; margin:12px 0; }
  </style>
</head>
<body>
  <header>
    <h1>Neverending Story</h1>
    <span class="pill" id="campaignPill">No campaign</span>
    <span class="muted" id="statusLine" style="margin-left:auto;">Ready.</span>
  </header>

  <main>
    <!-- LIBRARY / SETUP -->
    <section class="card" id="setupCard">
      <h2 style="margin:0 0 10px 0; font-size:14px;">Library</h2>
      <div id="libraryList" class="row"></div>
      <div class="divider"></div>

      <h2 style="margin:0 0 10px 0; font-size:14px;">Start new story</h2>
      <div class="row">
        <div style="flex:2; min-width:240px;">
          <label>Worker URL</label>
          <input id="workerUrl" placeholder="https://your-worker.workers.dev/" />
        </div>
        <div style="flex:1; min-width:180px;">
          <label>Campaign name</label>
          <input id="campaignName" placeholder="My Epic Campaign" />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div style="flex:1; min-width:180px;">
          <label>Rating</label>
          <select id="rating">
            <option>G</option>
            <option>PG</option>
            <option selected>PG-13</option>
            <option>R</option>
          </select>
        </div>
        <div style="flex:1; min-width:180px;">
          <label>Pacing</label>
          <select id="pacing">
            <option value="short">Short</option>
            <option value="medium" selected>Medium</option>
            <option value="long">Long</option>
            <option value="chapter">Chapter</option>
          </select>
        </div>
        <div style="flex:1; min-width:180px;">
          <label>Voice</label>
          <select id="voiceMode">
            <option value="off">Off</option>
            <option value="on" selected>On (English voice)</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div style="flex:1; min-width:260px;">
          <label>Story seed (what kind of story/world?)</label>
          <textarea id="seed" placeholder="Example: A Shadowrun-style neon megacity heist story with a small crew, slow-burn worldbuilding, and meaningful choices."></textarea>
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="primary" id="startBtn">Start</button>
        <button id="wipeBtn">Wipe local data (this device)</button>
      </div>

      <p class="muted small" style="margin-top:10px;">
        Tip: iOS can cache aggressively. If things act “stuck”, do a hard refresh and/or clear website data.
      </p>
    </section>

    <!-- PLAY -->
    <section class="card" id="playCard" style="display:none;">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <div class="row">
          <button id="backBtn">Library</button>
          <button id="replayBtn">Replay</button>
          <button id="undoBtn">Undo</button>
        </div>
        <button class="primary" id="continueBtn">Continue</button>
      </div>

      <div class="divider"></div>

      <div class="story" id="storyText">—</div>

      <div class="divider"></div>

      <h3 style="margin:0 0 10px 0; font-size:13px;">Choices</h3>
      <div class="choices" id="choices"></div>

      <div class="divider"></div>

      <h3 style="margin:0 0 8px 0; font-size:13px;">Something else</h3>
      <div class="row">
        <input id="wildInput" placeholder="Type your action…" />
        <button id="wildBtn">Do it</button>
      </div>

      <div class="divider"></div>

      <details>
        <summary>Debug / Memory</summary>
        <pre id="memoryBox" class="muted small" style="white-space:pre-wrap;"></pre>
      </details>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
